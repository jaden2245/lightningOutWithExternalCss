<html>
<title>Test 9 with ID Selector</title>
<style>
    a {
        color: brown;
    }
</style>

<script src="https://marriottintl--dttdev.sandbox.my.salesforce.com/lightning/lightning.out.js"></script>
<link rel="stylesheet" href="https://jaden2245.github.io/lightningOut/mystyles.css">

<div>
    <label for="idSelector">Choose a Case ID:</label>
    <select id="idSelector">
        <option value="5007x00000NJBTyAAP">Case ID 1</option>
        <option value="5007x00000OmqbCAAR">Case ID 2</option>
        <option value="5007x00000NJWtOAAX">Case ID 3</option>
    </select>
    <button id="renderButton">Render in LightningOut</button>
</div>

<div data-lightning-out="true"></div>

<script>
    const appName = 'c:ShowTest';
    const componentName = 'c:caseViewEdit';
    const lightningEndpoint = 'https://marriottintl--dttdev.sandbox.lightning.force.com';
    const tokenUrl = 'https://marriottintl--dttdev.sandbox.my.salesforce.com/services/oauth2/token';
    const jwtToken = 'eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiIzTVZHOW5pM0MwYlVGamtwS3VXVUFtUEpiQlhmZDhxS1huYWdRTjdDR2tUOUVNZThxdFBUb1k1MW9FSldBeFgxRVZfX2w2WnFDZ1FvakloMzVMRF9qIiwic3ViIjoianVsaXVzLmFkZW5pcmFuQG1hcnJpb3R0LXNwLmNvbS5tZ3BxYS5kdHRkZXYiLCJhdWQiOiJodHRwczovL3Rlc3Quc2FsZXNmb3JjZS5jb20iLCJleHAiOiIxOTA5OTkwMjM2In0.pQNAACTHL8Uktat1K2oK_5ZukbH4UFiu571UD5yQhPwqcoJpT85hniyI6aGwtIzVQ-iPJXTMPvMrC45EjRAJm3yiWpRYoZY65gU2HXwTzi1wFtwEIp1EwmVpuirFIlY6YwIzrwPAXEFS1dIJeIekc6VVfeDbOYI70i6T4kA6VbDtsrF2254lQTOA3vrxiyrIkbmDZYWtf-vAJnIYxjKDbsecH3KbxiFX1t_ce9EEQrJjdY_NdkxGM11Z8AvkxIOWR7tm4sijxlv0V86NQsk7tBwODYf77kWPUZFzmy66spey-KY8H3S2ShjlItLD8I_hfsqMGUvhjzzWzfGp8Vd5rQ'; // Replace with your actual JWT assertion
    const targetElement = document.querySelector("[data-lightning-out]");
    const externalCssUrl = "https://jaden2245.github.io/lightningOut/mystyles.css";

    // Fetch access token for authentication
    async function fetchAccessToken() {
        const headers = {
            'Content-Type': 'application/x-www-form-urlencoded',
        };

        try {
            const response = await fetch(tokenUrl, {
                method: 'POST',
                headers: headers,
                body: new URLSearchParams({
                    grant_type: 'urn:ietf:params:oauth:grant-type:jwt-bearer',
                    assertion: jwtToken,
                }),
            });

            if (!response.ok) {
                throw new Error(`Error fetching token: ${response.statusText}`);
            }

            const data = await response.json();
            return data.access_token;
        } catch (error) {
            console.error('Failed to fetch access token:', error);
        }
    }

    // Clear the target element and initialize LightningOut
    async function initializeLightningOut(recordId) {
        // Clear the previous component
        targetElement.innerHTML = '';

        const accessToken = await fetchAccessToken();

        if (!accessToken) {
            console.error('Access token is not available. LightningOut cannot be initialized.');
            return;
        }

        console.log('Initializing LightningOut with recordId:', recordId);
        $Lightning.use(
            appName,
            function () {
                $Lightning.createComponent(
                    componentName,
                    { recordId, externalCssUrl }, // Pass the recordId as an attribute
                    targetElement,
                    function (cmp) {
                        console.log('Lightning component created successfully with recordId:', recordId);
                    }
                );
            },
            lightningEndpoint,
            accessToken
        );
    }

    // Set up event listener for the render button
    document.getElementById('renderButton').addEventListener('click', () => {
        const selectedId = document.getElementById('idSelector').value;
        initializeLightningOut(selectedId);
    });
</script>
</html>
